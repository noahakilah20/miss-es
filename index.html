<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Jogo da Aninha - Fase 3 ðŸŽ®ðŸŒ¸</title>
  <style>
    body { margin: 0; padding: 0; background: #fff; font-family: Arial, sans-serif; }
    canvas { background: #fff; display: block; margin: 0 auto; border: 2px solid #000; }
  </style>
</head>
<body>

<audio id="blocoSound" src="sounds/bloco.mp3"></audio>
<audio id="vitoriaSound" src="sounds/vitoria.mp3"></audio>

<canvas id="jogo" width="400" height="600"></canvas>

<script>
  const canvas = document.getElementById("jogo");
  const ctx = canvas.getContext("2d");

  // Bola
  let bola = {
    x: canvas.width / 2,
    y: canvas.height - 30,
    dx: 3,
    dy: -3,
    raio: 10,
    cor: "#ff69b4"
  };

  // Barra
  let barra = {
    altura: 10,
    largura: 75,
    x: (canvas.width - 75) / 2
  };

  // Controle do teclado
  let direitaPressionada = false;
  let esquerdaPressionada = false;

  document.addEventListener("keydown", teclaPressionada, false);
  document.addEventListener("keyup", teclaSolta, false);

  function teclaPressionada(e) {
    if (e.key === "ArrowRight" || e.key === "Right") direitaPressionada = true;
    else if (e.key === "ArrowLeft" || e.key === "Left") esquerdaPressionada = true;
  }

  function teclaSolta(e) {
    if (e.key === "ArrowRight" || e.key === "Right") direitaPressionada = false;
    else if (e.key === "ArrowLeft" || e.key === "Left") esquerdaPressionada = false;
  }

  // Tijolos
  const linha = 4;
  const coluna = 7;
  const larguraTijolo = 50;
  const alturaTijolo = 20;
  const espacamento = 10;
  const margemSuperior = 30;
  const margemLateral = 30;

  let tijolos = [];
  for (let c = 0; c < coluna; c++) {
    tijolos[c] = [];
    for (let l = 0; l < linha; l++) {
      tijolos[c][l] = { x: 0, y: 0, visivel: true };
    }
  }

  // Bolinhas coloridas que aparecem quando o tijolo Ã© destruÃ­do
  let particulas = [];

  function criaParticulas(x, y) {
    const cores = ["#ff69b4", "#ff0000", "#00bfff", "#ffff00", "#800080"];
    for (let i = 0; i < 15; i++) {
      particulas.push({
        x: x + larguraTijolo / 2,
        y: y + alturaTijolo / 2,
        dx: (Math.random() - 0.5) * 4,
        dy: (Math.random() - 0.5) * 4,
        raio: Math.random() * 3 + 2,
        cor: cores[Math.floor(Math.random() * cores.length)],
        alpha: 1
      });
    }
  }

  function atualizaParticulas() {
    for (let i = particulas.length -1; i >= 0; i--) {
      const p = particulas[i];
      p.x += p.dx;
      p.y += p.dy;
      p.alpha -= 0.02;
      if (p.alpha <= 0) {
        particulas.splice(i, 1);
      }
    }
  }

  function desenhaParticulas() {
    particulas.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.raio, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(${hexToRgb(p.cor)},${p.alpha})`;
      ctx.fill();
      ctx.closePath();
    });
  }

  // Converter hex para rgb para usar no rgba()
  function hexToRgb(hex) {
    hex = hex.replace("#", "");
    let bigint = parseInt(hex, 16);
    let r = (bigint >> 16) & 255;
    let g = (bigint >> 8) & 255;
    let b = bigint & 255;
    return `${r},${g},${b}`;
  }

  // Sons do jogo
  const audioTijolo = document.getElementById("blocoSound");
  const audioVitoria = document.getElementById("vitoriaSound");

  // Desenhar a bola
  function desenhaBola() {
    ctx.beginPath();
    ctx.arc(bola.x, bola.y, bola.raio, 0, Math.PI * 2);
    ctx.fillStyle = bola.cor;
    ctx.fill();
    ctx.closePath();
  }

  // Desenhar a barra
  function desenhaBarra() {
    ctx.beginPath();
    ctx.rect(barra.x, canvas.height - barra.altura, barra.largura, barra.altura);
    ctx.fillStyle = "#0000FF";
    ctx.fill();
    ctx.closePath();
  }

  // Desenhar tijolos
  function desenhaTijolos() {
    for (let c = 0; c < coluna; c++) {
      for (let l = 0; l < linha; l++) {
        if (tijolos[c][l].visivel) {
          let tijoloX = c * (larguraTijolo + espacamento) + margemLateral;
          let tijoloY = l * (alturaTijolo + espacamento) + margemSuperior;
          tijolos[c][l].x = tijoloX;
          tijolos[c][l].y = tijoloY;
          ctx.beginPath();
          ctx.rect(tijoloX, tijoloY, larguraTijolo, alturaTijolo);
          ctx.fillStyle = "#ccc";
          ctx.fill();
          ctx.closePath();
        }
      }
    }
  }

  // Detectar colisÃ£o da bola com os tijolos
  function detectarColisao() {
    for (let c = 0; c < coluna; c++) {
      for (let l = 0; l < linha; l++) {
        let t = tijolos[c][l];
        if (t.visivel) {
          if (
            bola.x > t.x &&
            bola.x < t.x + larguraTijolo &&
            bola.y > t.y &&
            bola.y < t.y + alturaTijolo
          ) {
            bola.dy = -bola.dy;
            t.visivel = false;

            // Tocar som do tijolo
            audioTijolo.currentTime = 0;
            audioTijolo.play();

            // Criar partÃ­culas coloridas na posiÃ§Ã£o do tijolo destruÃ­do
            criaParticulas(t.x, t.y);

            // Mudar cor da bola
            mudarCorBola();

            // Verificar vitÃ³ria
            if (todosTijolosDestruÃ­dos()) {
              audioVitoria.play();
              setTimeout(() => alert("ParabÃ©ns! VocÃª venceu a fase 3! ðŸŽ‰"), 200);
            }
          }
        }
      }
    }
  }

  // Mudar cor da bola aleatoriamente
  function mudarCorBola() {
    const cores = ["#ff69b4", "#ff0000", "#00bfff", "#ffff00", "#800080"];
    bola.cor = cores[Math.floor(Math.random() * cores.length)];
  }

  // Verifica se todos os tijolos foram destruÃ­dos
  function todosTijolosDestruÃ­dos() {
    for (let c = 0; c < coluna; c++) {
      for (let l = 0; l < linha; l++) {
        if (tijolos[c][l].visivel) return false;
      }
    }
    return true;
  }

  // FunÃ§Ã£o principal do desenho do jogo
  function desenha() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    desenhaTijolos();
    desenhaBola();
    desenhaBarra();
    detectarColisao();
    desenhaParticulas();
    atualizaParticulas();

    // ColisÃ£o com paredes
    if (bola.x + bola.dx > canvas.width - bola.raio || bola.x + bola.dx < bola.raio) bola.dx = -bola.dx;
    if (bola.y + bola.dy < bola.raio) bola.dy = -bola.dy;
    else if (bola.y + bola.dy > canvas.height - bola.raio) {
      if (bola.x > barra.x && bola.x < barra.x + barra.largura) bola.dy = -bola.dy;
      else document.location.reload();
    }

    // MovimentaÃ§Ã£o da bola
    bola.x += bola.dx;
    bola.y += bola.dy;

    // MovimentaÃ§Ã£o da barra
    if (direitaPressionada && barra.x < canvas.width - barra.largura) barra.x += 7;
    else if (esquerdaPressionada && barra.x > 0) barra.x -= 7;

    requestAnimationFrame(desenha);
  }

  desenha();
</script>

</body>
</html>
